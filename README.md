# Project 8 - Pentesting Live Targets

Time spent: **13** hours spent in total

> Objective: Identify vulnerabilities in three different versions of the Globitek website: blue, green, and red.

The six possible exploits are:

* Username Enumeration
* Insecure Direct Object Reference (IDOR)
* SQL Injection (SQLi)
* Cross-Site Scripting (XSS)
* Cross-Site Request Forgery (CSRF)
* Session Hijacking/Fixation

Each color is vulnerable to only 2 of the 6 possible exploits. First discover which color has the specific vulnerability, then write a short description of how to exploit it, and finally demonstrate it using screenshots compiled into a GIF.

## Blue

Vulnerability #1: SQL Injection 

An injection is possible via the URL of bluesite. In particular, when navigating through the salespersons, the url id can be replaced with a bit of SQL code. For the sake of proving this vulnerability, the example SQL code was used: 

```' OR SLEEP(5)=0--'``` 

![SQLIBlue](https://user-images.githubusercontent.com/95894083/164401768-6d30c996-5ff5-4157-828d-ab0e05ae5d43.gif)

Vulnerability #2: Session Hijacking

Due to bluesite having sessions alive for almost a year, an attacker can easily help themselves to stealing and using a session ID of someone already logged in. For this exploit, I chose session hijack instead of fixation. I used the provided tool, "public/hacktools/change_session_id.php" to change my session from browser to browser. In this attack, Chrome was the attacker who stole the session ID of the victim, Firefox. 

![HijackBlue](https://user-images.githubusercontent.com/95894083/164861649-aac4f0c1-9548-4868-80c3-a56c78f44ab8.gif)

## Green

Vulnerability #1: XXS Time 

Stored XXS is possible due to a sanitation oversight regarding feedback emails on green site. To execute, send an email with any name and any address with the XSS script as the message. The XXS used for this attack is straight from the provided example, ```<script>alert('Cole found the XSS!');</script>``` (replaced Mallory with Cole). 

![XXSGreen](https://user-images.githubusercontent.com/95894083/163956959-4a072dae-9b7a-4bff-9c17-5a71da5f4859.gif)

Vulnerability #2: User Enumeration Nation 

User enumeration is evident on green site, due to a small mistake with the class names that handle failed login attempts. When using an invalid username, the error message is displayed in normal text. When using a valid username (such as the one provided, "jmonroe99"), the text is bold. An attacker could assume that valid usernames therefore will show up in bold. 

Greensite error class name ("failed") when the username is invalid: 

![image](https://user-images.githubusercontent.com/95894083/163947898-20c81d78-355e-4140-a9ab-1d712a8472e0.png)

Greensite error class name ("failure") when the username is valid: 

![image](https://user-images.githubusercontent.com/95894083/163948906-eb0aea84-4a2e-4a5c-b586-06f1e4df9cfe.png)

Blue and redsite error class whether username is valid or not: 

![image](https://user-images.githubusercontent.com/95894083/163948981-9b80f722-8b97-41ea-8c55-e494477b73fa.png)

The reason that no other sites have this issues is because greensite has two classes dedicated to handling failed login attempts. This mislable causes the error message to visibly change to the user. 

![UserEnumGreen](https://user-images.githubusercontent.com/95894083/163955938-ec116d49-8d67-4656-84fa-e4131213265f.gif)

## Red

Vulnerability #1: Good ol' IDOR 

URL manipulation of an exposed page id allows for any user on redsite to access pages that are not meant to be public. Entering "?id=10" or "?id=11" at the end of the URL when navigating through the "Find a Salesperson" page will take the user to profiles that are typically hidden to users. The other two sites will redirect you to the salesperson main page instead of allowing you to view the private pages. This vulnerability likely lies in an oversight on limiting what pages could be accessed with ids, even if they aren't initially visible to the user.  

![IDORred](https://user-images.githubusercontent.com/95894083/164177577-7854f586-ab4c-47a6-a88c-a03a6a1508e2.gif)

Vulnerability #2: CSRF

The fake form I was using is shown below. There is an element that is missing from it that is not allowing the form to properly change the names of the employees. Regardless, the gif below that shows the process I would take if the form was correctly crafted. I emailed the form to the admin as a link to open, that would modify the salesperson form to a different name. This same process could also be conducted externally, without the need to email the link. 

```
<html>
  <body onload="document.hiddenForm.submit()">
    <form name="hiddenForm" style="display:none" action="https://35.184.88.145/red/public/staff/salespeople/edit.php?id=6" target="target" method="post"> 
    <input type="text" name="first_name" value="Elizabeth" />
      <input type="text" name="last_name" value="OldPerson" />
      <input type="text" name="phone" value="555-532-3209" />
      <input type="text" name="email" value="eolson@salesperson.com" />
    </form>
    <iframe name="target" style="display:none" ></iframe>
  </body>
</html>
```

![CSRFRed](https://user-images.githubusercontent.com/95894083/164882794-77cef02f-08d9-4aff-9733-19286bcbe6de.gif)

## Notes

Finding which sites had which vulnerability was quite time consuming. After that the only two vulnerabilities that proved to be a challenge were CSRF and session hijacking/fixation. Fixation and hijacking were finnicky, as one moment they worked, but when I went back to record them, they no longer worked. CSRF took the most amount of time, and writing my own form was difficult. 
